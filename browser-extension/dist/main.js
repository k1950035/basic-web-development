(()=>{const e=document.querySelector(".form-data"),t=document.querySelector(".region-name"),o=document.querySelector(".api-key"),n=document.querySelector(".errors"),l=document.querySelector(".loading"),a=document.querySelector(".result-container"),r=document.querySelector(".carbon-usage"),c=(document.querySelector(".fossil-fuel"),document.querySelector(".my-region")),s=document.querySelector(".clear-btn");async function y(t,o){try{l.style.display="block",s.style.display="none";const n=await fetch(`https://api.electricitymaps.com/v3/carbon-intensity/latest?countryCode=${o}`,{method:"GET",headers:{"auth-token":t,"Content-Type":"application/json"}});if(!n.ok)throw new Error(`API request failed: ${n.status}`);const y=await n.json(),i=Math.round(y.carbonIntensity);calculateColor(i),l.style.display="none",e.style.display="none",a.style.display="block",s.style.display="block",c.textContent=o.toUpperCase(),r.textContent=`${i} grams (grams COâ‚‚ emitted per kilowatt hour)`}catch(e){console.error("Error fetching carbon data:",e),l.style.display="none",a.style.display="none",s.style.display="none",n.textContent="Sorry, we couldn't fetch data for that region. Please check your API key and region code."}}function i(){const t=localStorage.getItem("apiKey"),o=localStorage.getItem("regionName");null===t||null===o?(e.style.display="block",a.style.display="none",l.style.display="none",s.style.display="none",n.textContent=""):(y(t,o),a.style.display="none",e.style.display="none",s.style.display="block")}calculateColor=async e=>{let t=[0,150,600,750,800],o=t.sort((t,o)=>Math.abs(t-e)-Math.abs(o-e))[0],n=["#2AA364","#F5EB4D","#9E4229","#381D02","#381D02"][t.findIndex(e=>e>o)];chrome.runtime.sendMessage({action:"updateIcon",value:{color:n}})},e.addEventListener("submit",e=>function(e){e.preventDefault(),console.log("API Key:",o.value),console.log("Region:",t.value),function(e,t){localStorage.setItem("apiKey",e),localStorage.setItem("regionName",t),l.style.display="block",n.textContent="",s.style.display="block",y(e,t)}(o.value,t.value)}(e)),s.addEventListener("click",e=>function(e){e.preventDefault(),localStorage.removeItem("regionName"),i()}(e)),document.addEventListener("DOMContentLoaded",()=>{i()})})();